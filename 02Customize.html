<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Lagerliste</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; }
    ul { margin-top: 12px; padding-left: 18px; }
    .muted { color:#666; }
  </style>
</head>
<body>

  <label for="kategorien">Kategorie auswählen:</label>
  <select id="kategorien" name="kategorien">
    <option value="">— bitte wählen —</option>
    <option value="rahmen">Rahmen</option>
    <option value="laufradsatz">Laufradsatz</option>
    <option value="bremsen">Bremsen</option>
    <option value="schaltung">Schaltung</option>
    <option value="pedale">Pedale</option>
    <option value="kasette">Kasette</option>
    <option value="umwerfer">Umwerfer</option>
    <option value="schalthebel">Schalthebel</option>
    <option value="lenker">Lenker</option>
    <option value="vorbau">Vorbau</option>
    <option value="lenkerband">Lenkerband</option>
    <option value="sattel">Sattel</option>
    <option value="sattelstütze">Sattelstütze</option>
    <option value="sattelklemme">Sattelklemme</option>
    <option value="flaschenhalter">Flaschenhalter</option>
    <option value="zubehör">Zubehör</option>
  </select>

  <ul id="ergebnis"><li class="muted">Noch keine Auswahl</li></ul>

  <!-- 1) Deine Daten als JS-Variable einbinden -->
  <script src="data.js"></script>

  <!-- 2) Filter-Logik -->
  <script>
    // Mapping Dropdown -> Kategorie-Code in INVENTORY
    const CATEGORY_CODE = {
      rahmen: "RMN",
      // hier gern erweitern: bremsen: "BRM", schaltung: "SCH", ...
    };

    const CATEGORY_COL = "Kategorie"; // erkannte Spalte
    const PREFERRED_LABELS = ["Artikel","Bezeichnung","Produkt","Name","Titel"];

    const $sel  = document.getElementById("kategorien");
    const $list = document.getElementById("ergebnis");

    function pickLabelKey(head) {
      for (const k of PREFERRED_LABELS) if (head.includes(k)) return k;
      return head[0];
    }

    // Kopfzeilen aus einem beliebigen Datensatz ableiten
    const HEAD = INVENTORY.length ? Object.keys(INVENTORY[0]) : [];
    const labelKey = pickLabelKey(HEAD);

    function renderList(items) {
      if (!items.length) {
        $list.innerHTML = `<li class="muted">Keine Treffer.</li>`;
        return;
      }
      $list.innerHTML = items.map(r => `<li>${escapeHtml(r[labelKey] || "")}</li>`).join("");
    }

    function escapeHtml(s) {
      return (s||"").toString().replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
    }

    function applyFilter() {
      const val  = ($sel.value || "").toLowerCase();
      const code = CATEGORY_CODE[val];
      if (!code) { renderList([]); return; }
      const hits = (INVENTORY || []).filter(r => (r[CATEGORY_COL] || "").toUpperCase() === code);
      renderList(hits);
    }

    $sel.addEventListener("change", applyFilter);
    // Optional: direkt beim Laden filtern, wenn schon etwas vorausgewählt ist
    applyFilter();
  </script>
</body>
</html>
